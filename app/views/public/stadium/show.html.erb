<main>
<div class="row">

 <div class="col s4 ">
    <ul class="collapsible popout ">
        <li class="center-align">
          <laber><%= attachment_image_tag @posted, :image, :fill, 100, 100, fallback: "no_image.png", size:'150x150' %></laber>
          <div class="collapsible-header grey lighten-4"><h5><%= @posted.name %></h5></div>
        </li>
        <li>
          <div class="collapsible-header grey lighten-4"><h6>球場紹介</h6></div>
          <div class="collapsible-body grey lighten-4"><%= @posted.information %></div>
        </li>
         <li>
          <div class="collapsible-header grey lighten-4"><h6>球場詳細</h6></div>
          <div class="collapsible-body grey lighten-4"></div>
        </li>
        <li>
        <div class="collapsible-header grey lighten-4"><h6>球場評価</h6></div>
        <div class="collapsible-body grey lighten-4">
          <div class='form-group'>

            <label>アクセス採点</label>
             <span class="blue-text text-darken-2"><%= @access %></span><br>
            <div id='star-rate'></div>

            <label>グルメ採点</label>
            <span class="blue-text text-darken-2"><%= (@gouremet).floor(2) %></span><br>
            <div id='star2-rate'></div>

            <label>ムード採点</label>
             <span class="blue-text text-darken-2"><%= (@mood).floor(2) %></span><br>
            <div id='star3-rate'></div>

            <label>キャパシティ採点</label>
            <span class="blue-text text-darken-2"><%=(@capacity).floor(2) %></span><br>
            <div id='star4-rate'></div>

            <label>観光採点</label>
             <span class="blue-text text-darken-2"><%= (@gouremet).floor(2) %></span><br>
            <div id='star5-rate'></div>

            <h6>総合採点</h6>
             <h5 class="blue-text text-darken-2"><%= (@total_rate).floor(2) %></h6>
           <!--  <div id='star6-rate'></div> -->




          </div>
        </div>
      </li>
    </ul>
  </div>


  <div class='col s8 center-align'>
    <div id='map' data-posteds='<%= @posteds %>'></div>
  </div>

<div class="row">
   <div class='col s12 '>
      <h7>ユーザー投稿一覧</h7>
     <% @posts.each do |post| %>
    <div class="card grey lighten-4">
      <div class="left-align">
         <%= link_to  public_post_path(post.id) do %><%= attachment_image_tag post, :posted_image, :fill, 250, 250, fallback: "no_image.png", size:'100x100' %><% end %>
          <span class="card-title"> <%= link_to  public_stadium_path(post.stadium.id) do %> <%= post.stadium.name %><% end %></span>&emsp;
          <span><%= link_to  public_user_path(post.user.id) do %><%= post.user.name %><% end %></span>&emsp;
          <span><%= post.watching_date.strftime("%Y年%m月%d日") %></span>
      </div>
       <div class="card-content">
        <%= link_to  public_post_path(post.id) do %><%= post.post_content %><% end %>
       </div>

        <div class="card-action">
              <span><%= render 'public/favorites/favorite',post: post %></span>
              <span><%= render 'public/relationships/follow_button', user: post.user %></span>
        </div>     　
      </div>
   <% end %>
       </div>

    <%= paginate @posts %>

</div>
   </div>
</main>





















    <script>
          $('#star-rate').raty({
            size: 36,
            starOff:  '<%= asset_path('star-off.png') %>',
            starOn : '<%= asset_path('star-on.png') %>',
            starHalf: '<%= asset_path('star-half.png') %>',
            half: true,
            readOnly: true,
            score: '<%=@access  %>'
          });
          </script>
          <script>
          $('#star2-rate').raty({
            size: 36,
            starOff:  '<%= asset_path('star-off.png') %>',
            starOn : '<%= asset_path('star-on.png') %>',
            starHalf: '<%= asset_path('star-half.png') %>',
            half: true,
            readOnly: true,
            score: '<%=  @gouremet %>'
          });
          </script>

          <script>
          $('#star3-rate').raty({
            size: 36,
            starOff:  '<%= asset_path('star-off.png') %>',
            starOn : '<%= asset_path('star-on.png') %>',
            starHalf: '<%= asset_path('star-half.png') %>',
            half: true,
            readOnly: true,
            score: '<%= @mood %>',
          });
          </script>

          <script>
          $('#star4-rate').raty({
            size: 36,
            starOff:  '<%= asset_path('star-off.png') %>',
            starOn : '<%= asset_path('star-on.png') %>',
            starHalf: '<%= asset_path('star-half.png') %>',
            half: true,
            readOnly: true,
            score: '<%=  @capacity %>',
          });
          </script>
          <script>
          $('#star5-rate').raty({
            size: 36,
            starOff:  '<%= asset_path('star-off.png') %>',
            starOn : '<%= asset_path('star-on.png') %>',
            starHalf: '<%= asset_path('star-half.png') %>',
            half: true,
            readOnly: true,
            score: '<%= @sightseeing  %>',
          });
          </script>
　　　　　　　<script>
          $('#star6-rate').raty({
            size: 36,
            starOff:  '<%= asset_path('star-off.png') %>',
            starOn : '<%= asset_path('star-on.png') %>',
            starHalf: '<%= asset_path('star-half.png') %>',
            half: true,
            readOnly: true,
            score: '<%= @total_rate  %>',
          });
          </script>

            <script type="text/javascript">
          function initMap() {
            var test = {lat: <%=  @posted.latitude %>, lng: <%=  @posted.longitude %>};
            var map = new google.maps.Map(document.getElementById('map'), {
              zoom: 10,
              center: test
            });

            var transitLayer = new google.maps.TransitLayer();
            transitLayer.setMap(map);

            var posteds = 
            $('#map').data('posteds')
                // JSのeach文
            posteds.forEach(function(posted){
            //posteds.each do |posted|
              var hoge = {lat: posted.latitude, lng: posted.longitude};
              console.log(hoge)
              var contentString = '住所：' + posted.address;
              var infowindow = new google.maps.InfoWindow({
                content: contentString
              });

              var marker = new google.maps.Marker({
                position:hoge,
                map: map,
                title: contentString

              });

              marker.addListener('click', function() {
                infowindow.open(map, marker);
              });
            })

          }

        </script>
        <script async defer
         
           src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=<%= ENV["GOOGLE_MAP_API_KEY"]%>&callback=initMap">
        </script>



